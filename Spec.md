# 仕様書: 映画ブログ記事自動生成システム

## 1. プロジェクト概要

本プロジェクトは、ユーザー自身の既存の映画ブログ記事を学習データとして活用し、ユーザー特有のスタイルを模倣した新しい映画ブログ記事を自動生成するシステムを開発する。将来的には、下書きや映画のメタ情報（監督、キャスト等）を入力として、より完成度の高い記事生成を目指す。

## 2. 目的

- ユーザーの文体、トーン、視点、構成を学習し、再現する。
- 映画ブログ記事作成の効率化を支援する。
- LLMのファインチューニング技術とプロンプトエンジニアリングを探求する。

## 3. コア技術・アーキテクチャ

- **LLM (Large Language Model):**
    - **初期利用モデル:** OpenAI GPTシリーズ (例: `gpt-3.5-turbo`, `gpt-4o`) をクラウドAPI経由で利用。
    - **将来的な拡張性:** 他の商用APIモデルやオープンソースモデルへの切り替えを考慮した設計とする。
- **ファインチューニング:**
    - **手法:** ユーザー提供のブログ記事データセット (`output.jsonl`) を用いて、ベースLLMをファインチューニングする。
    - **効率化:** PEFT (Parameter-Efficient Fine-Tuning) の一種であるLoRA (Low-Rank Adaptation) の導入を検討する。
- **システム構成:**
    - **言語:** Python
    - **LLM連携:** API経由
    - **モジュール構成:** プロンプト管理、記事生成ロジック、LLMクライアントアダプター、設定管理など。

## 4. 主要機能

### 4.1. 記事生成機能
- **入力:**
    - 映画タイトル
    - キーワード
    - 下書きテキスト (オプション)
    - 関連情報（監督、キャスト、公開年など - オプション）
- **出力:** 指定された入力に基づき生成された映画ブログ記事。
- **調整可能パラメータ (プロパティ):**
    - `temperature`: 生成テキストのランダム性・創造性を制御。
    - `max_tokens`: 生成テキストの最大長を制御。
    - その他、利用LLMが提供するパラメータ。

### 4.2. プロンプト管理機能
- プロンプトテンプレートを利用し、動的な情報を埋め込み可能とする。
- ユーザーのブログスタイルを反映させるための指示をプロンプトに組み込む。
- 柔軟なプロンプト構築・管理を実現する。

### 4.3. LLMクライアント切り替え機能
- 設定ファイルやアダプターパターンの利用により、バックエンドで使用するLLMを容易に変更可能な設計とする。

### 4.4. ファインチューニング支援機能 (オプション)
- ファインチューニング用データの準備（フォーマット変換等）を補助するスクリプトを提供する。
- ファインチューニング済みモデルのIDを設定ファイルで管理する。

## 5. データ

- **学習データ:**
    - **ソース:** `output.jsonl` (ユーザー提供の映画ブログ記事)
    - **件数:** 約123件
    - **形式:** JSON Lines (`.jsonl`)
    - **構造 (各行):** `{"id": "...", "title": "...", "text": "...", "category": "...", "post_date": "..."}`
- **生成記事:**
    - 生成されたブログ記事は、指定されたローカルディレクトリに保存する。

## 6. 開発環境・ツール

- **OS:** Windows 11 + WSL2 (Ubuntu 22.04)
- **GPU:** NVIDIA GeForce RTX 3060
- **CUDA/cuDNN:** CUDA Toolkit 12.9, cuDNN
- **Python:** 3.10 (conda環境 `llm_env`)
- **主要ライブラリ:**
    - `openai` (OpenAI APIクライアント)
    - `torch` (PyTorch - ローカルでの実験やオープンソースモデル利用時)
- **バージョン管理:** Git, GitHub

## 7. ディレクトリ構成 (予定)

```
.  # 現在のプロジェクトルート (/home/tsuyoshi/projects/llm_challenge)
├── Spec.md  # このドキュメント
├── src/
│   ├── core/
│   │   ├── llm_client_interface.py
│   │   └── adapters/
│   │       ├── openai_adapter.py
│   │       └── (other_llm_adapter.py) # 将来の拡張用
│   ├── prompts/
│   │   ├── templates/
│   │   │   └── movie_review_template.txt
│   │   └── prompt_manager.py
│   ├── generator/
│   │   └── article_generator.py
│   ├── config/
│   │   └── settings.py
│   ├── utils/
│   │   └── file_utils.py # ファイル操作関連ユーティリティ
│   └── main.py           # アプリケーションのエントリーポイント
├── data/
│   ├── finetuning_data/
│   │   └── training_corpus.jsonl  # output.jsonl をここに配置・加工
│   └── generated_articles/        # 生成された記事の保存場所
├── scripts/
│   └── (run_finetuning.py)      # ファインチューニング実行スクリプト (オプション)
├── tests/                         # 単体テスト等
├── requirements.txt               # Pythonの依存パッケージリスト
└── README.md                      # プロジェクトの説明、セットアップ方法など
```

## 8. 今後の開発ステップ (初期)

1.  `requirements.txt` の整備とライブラリインストール。
2.  `src/config/settings.py` にAPIキーやモデル設定を記述。
3.  `src/core/` 以下にLLMクライアントインターフェースとOpenAI用アダプターを実装。
4.  `src/prompts/` 以下にプロンプトテンプレートとプロンプトマネージャーを実装。
5.  `src/generator/article_generator.py` に記事生成ロジックを実装。
6.  `src/main.py` で基本的な記事生成フローをテスト (ファインチューニングなしのベースモデルで)。
7.  ファインチューニング用データの準備とOpenAI APIを利用したファインチューニングの実行。
8.  ファインチューニング済みモデルを利用した記事生成と評価、改善。

---
*このドキュメントは現時点での計画であり、開発の進行に伴い変更される可能性があります。*